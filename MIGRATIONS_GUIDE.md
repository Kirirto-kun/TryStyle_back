# Ð ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ð¿Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑÐ¼Ð¸ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…

## Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸?

ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ â€” ÑÑ‚Ð¾ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð± Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…. ÐžÐ½Ð¸ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÑŽÑ‚:
- âœ… Ð’ÐµÑ€ÑÐ¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÑÑ…ÐµÐ¼Ñ‹ Ð‘Ð”
- âœ… ÐžÑ‚ÐºÐ°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸  
- âœ… Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð‘Ð” Ð¼ÐµÐ¶Ð´Ñƒ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ°Ð¼Ð¸
- âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ðµ

## ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°

Ð’ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ [Alembic](https://alembic.sqlalchemy.org/) Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑÐ¼Ð¸. ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ ÑƒÐ¶Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð°:

```
alembic/                    # ÐŸÐ°Ð¿ÐºÐ° Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑÐ¼Ð¸
â”œâ”€â”€ env.py                  # ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Alembic
â”œâ”€â”€ script.py.mako         # Ð¨Ð°Ð±Ð»Ð¾Ð½ Ð´Ð»Ñ Ð½Ð¾Ð²Ñ‹Ñ… Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹  
â””â”€â”€ versions/              # Ð¤Ð°Ð¹Ð»Ñ‹ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹
alembic.ini                # ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
```

## ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑÐ¼Ð¸

### Ð¡Ð¿Ð¾ÑÐ¾Ð± 1: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹Ñ… ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð² (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)

#### Python ÑÐºÑ€Ð¸Ð¿Ñ‚ (Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ð²ÑÐµÑ… ÐžÐ¡):
```bash
# ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
python scripts/migrate.py upgrade

# Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ
python scripts/migrate.py revision "Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð²"

# ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ
python scripts/migrate.py downgrade

# ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰ÑƒÑŽ Ð²ÐµÑ€ÑÐ¸ÑŽ Ð‘Ð”
python scripts/migrate.py current

# ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹
python scripts/migrate.py history
```

#### Bash ÑÐºÑ€Ð¸Ð¿Ñ‚ (Linux/macOS):
```bash
# ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
./scripts/migrate.sh upgrade

# Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ
./scripts/migrate.sh revision "Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð²"

# ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ
./scripts/migrate.sh downgrade

# ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰ÑƒÑŽ Ð²ÐµÑ€ÑÐ¸ÑŽ Ð‘Ð”
./scripts/migrate.sh current

# ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹
./scripts/migrate.sh history
```

### Ð¡Ð¿Ð¾ÑÐ¾Ð± 2: ÐŸÑ€ÑÐ¼Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Alembic

Ð•ÑÐ»Ð¸ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾:

```bash
# ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
alembic upgrade head

# Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ Ñ Ð°Ð²Ñ‚Ð¾Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸ÐµÐ¹
alembic revision --autogenerate -m "ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹"

# ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð½Ð° Ð¾Ð´Ð½Ñƒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ Ð½Ð°Ð·Ð°Ð´
alembic downgrade -1

# ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰ÑƒÑŽ Ð²ÐµÑ€ÑÐ¸ÑŽ
alembic current

# ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ
alembic history
```

## Ð Ð°Ð±Ð¾Ñ‡Ð¸Ð¹ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ

### 1. ÐŸÑ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¸ Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹

1. **Ð˜Ð·Ð¼ÐµÐ½ÑÐµÑ‚Ðµ Ð¼Ð¾Ð´ÐµÐ»ÑŒ** Ð² `src/models/`:
   ```python
   # ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚Ðµ Ð½Ð¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ Ð² Ð¼Ð¾Ð´ÐµÐ»ÑŒ User
   class User(Base):
       # ... ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð¿Ð¾Ð»Ñ
       phone = Column(String, nullable=True)  # ÐÐ¾Ð²Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
   ```

2. **Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ**:
   ```bash
   python scripts/migrate.py revision "Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»Ðµ phone Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ users"
   ```

3. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð½ÑƒÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ** Ð² `alembic/versions/`:
   ```python
   def upgrade() -> None:
       op.add_column('users', sa.Column('phone', sa.String(), nullable=True))
   
   def downgrade() -> None:
       op.drop_column('users', 'phone')
   ```

4. **ÐŸÑ€Ð¸Ð¼ÐµÐ½ÑÐµÑ‚Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ**:
   ```bash
   python scripts/migrate.py upgrade
   ```

### 2. Ð Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ

```bash
# 1. ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÑ‚Ðµ ÐºÐ¾Ð´
git pull

# 2. ÐÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐµÑ‚Ðµ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ
source venv/bin/activate

# 3. ÐŸÑ€Ð¸Ð¼ÐµÐ½ÑÐµÑ‚Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
python scripts/migrate.py upgrade

# 4. ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
# (Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ð²Ð°ÑˆÐµÐ³Ð¾ ÑÐ¿Ð¾ÑÐ¾Ð±Ð° Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ)
```

### 3. ÐžÑ‚ÐºÐ°Ñ‚ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹

Ð•ÑÐ»Ð¸ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ð¾ÑˆÐ»Ð¾ Ð½Ðµ Ñ‚Ð°Ðº:

```bash
# ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ
python scripts/migrate.py downgrade

# ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð´Ð¾ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¹ Ð²ÐµÑ€ÑÐ¸Ð¸
alembic downgrade abc123def456
```

## Ð’Ð°Ð¶Ð½Ñ‹Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹

### âš ï¸ Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ñ…

- **Ð’ÑÐµÐ³Ð´Ð° Ð´ÐµÐ»Ð°Ð¹Ñ‚Ðµ Ð±ÑÐºÐ°Ð¿** Ð¿ÐµÑ€ÐµÐ´ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸ÐµÐ¼ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹ Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ðµ
- **Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸** Ð½Ð° ÐºÐ¾Ð¿Ð¸Ð¸ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐ½ Ð±Ð°Ð·Ñ‹
- **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐ¹Ñ‚Ðµ Ð°Ð²Ñ‚Ð¾Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸** â€” Alembic Ð¼Ð¾Ð¶ÐµÑ‚ Ð½Ðµ Ð²ÑÑ‘ Ð¿Ð¾Ð½ÑÑ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾

### âš ï¸ ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹, Ñ‚Ñ€ÐµÐ±ÑƒÑŽÑ‰Ð¸Ðµ Ð¾ÑÑ‚Ð¾Ñ€Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸

```python
# ÐžÐ¿Ð°ÑÐ½Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ (Ð¿Ð¾Ñ‚ÐµÑ€Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…):
op.drop_table('table_name')           # Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹
op.drop_column('table', 'column')     # Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚Ð¾Ð»Ð±Ñ†Ð°
op.alter_column('table', 'col', nullable=False)  # ÐœÐ¾Ð¶ÐµÑ‚ ÑƒÐ¿Ð°ÑÑ‚ÑŒ Ð½Ð° ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ñ… NULL

# Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸:
op.add_column('table', Column(...))   # Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚Ð¾Ð»Ð±Ñ†Ð°
op.create_index('idx_name', 'table', ['column'])  # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ°
```

### ðŸ“ Ð¥Ð¾Ñ€Ð¾ÑˆÐ¸Ðµ Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ¸

1. **ÐžÐ¿Ð¸ÑÐ°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹**:
   ```bash
   âœ… "Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²"
   âœ… "Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¸Ð½Ð´ÐµÐºÑ Ð½Ð° email Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹"
   âŒ "Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² Ð‘Ð”"
   âŒ "Ð¤Ð¸ÐºÑ"
   ```

2. **ÐžÐ´Ð½Ð° Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° = Ð¾Ð´Ð½Ð° Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ**

3. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐ¹Ñ‚Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð¿ÐµÑ€ÐµÐ´ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¾Ð¼**:
   ```bash
   # Ð¡Ð¾Ð·Ð´Ð°Ð»Ð¸ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ
   python scripts/migrate.py revision "Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»Ðµ"
   
   # ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ð»Ð¸
   python scripts/migrate.py upgrade
   
   # ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ð»Ð¸, Ñ‡Ñ‚Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
   python -m pytest tests/
   
   # ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ð»Ð¸ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸
   python scripts/migrate.py downgrade
   
   # Ð¡Ð½Ð¾Ð²Ð° Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸Ð»Ð¸
   python scripts/migrate.py upgrade
   ```

## Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ„Ð°Ð¹Ð»Ð° Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸

```python
"""ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸

Revision ID: abc123def456
Revises: xyz789uvw012
Create Date: 2025-06-30 12:00:00.000000

"""
from typing import Sequence, Union
from alembic import op
import sqlalchemy as sa

# revision identifiers, used by Alembic.
revision: str = 'abc123def456'
down_revision: Union[str, None] = 'xyz789uvw012'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None

def upgrade() -> None:
    """ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ"""
    # ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÑÑ…ÐµÐ¼Ñ‹
    pass

def downgrade() -> None:
    """ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ"""
    # ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Ð¾Ñ‚ÐºÐ°Ñ‚Ð° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹
    pass
```

## Ð£ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: "Target database is not up to date"

```bash
# Ð ÐµÑˆÐµÐ½Ð¸Ðµ: Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
python scripts/migrate.py upgrade
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: "Can't locate revision identified by 'xyz'"

```bash
# Ð ÐµÑˆÐµÐ½Ð¸Ðµ: Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ Ð¸ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ
python scripts/migrate.py history
alembic stamp head  # ÐŸÐ¾Ð¼ÐµÑ‚Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ ÐºÐ°Ðº Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: ÐšÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹

```bash
# Ð ÐµÑˆÐµÐ½Ð¸Ðµ: ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ merge Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ
alembic merge -m "ÐžÐ±ÑŠÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒ Ð²ÐµÑ‚ÐºÐ¸ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹" revision1 revision2
```

## Docker

Ð•ÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚Ðµ Docker, Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ Ð² `Dockerfile` Ð¸Ð»Ð¸ docker-compose:

```dockerfile
# Dockerfile
RUN python scripts/migrate.py upgrade
```

```yaml
# docker-compose.yml
version: '3.8'
services:
  web:
    # ...
    command: >
      sh -c "python scripts/migrate.py upgrade &&
             uvicorn src.main:app --host 0.0.0.0 --port 8000"
```

## ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ñ‚Ð¸Ð¿Ð¸Ñ‡Ð½Ñ‹Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹

### Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹

```python
def upgrade() -> None:
    op.create_table('products',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('name', sa.String(100), nullable=False),
        sa.Column('price', sa.Numeric(10, 2), nullable=False),
        sa.Column('created_at', sa.DateTime(), nullable=False),
        sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_products_name', 'products', ['name'])

def downgrade() -> None:
    op.drop_index('ix_products_name', table_name='products')
    op.drop_table('products')
```

### Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²Ð½ÐµÑˆÐ½ÐµÐ³Ð¾ ÐºÐ»ÑŽÑ‡Ð°

```python
def upgrade() -> None:
    op.add_column('orders', sa.Column('user_id', sa.Integer(), nullable=False))
    op.create_foreign_key('fk_orders_user_id', 'orders', 'users', ['user_id'], ['id'])

def downgrade() -> None:
    op.drop_constraint('fk_orders_user_id', 'orders', type_='foreignkey')
    op.drop_column('orders', 'user_id')
```

### Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð° ÑÑ‚Ð¾Ð»Ð±Ñ†Ð°

```python
def upgrade() -> None:
    # PostgreSQL
    op.alter_column('users', 'phone',
                    existing_type=sa.VARCHAR(),
                    type_=sa.String(20),
                    existing_nullable=True)

def downgrade() -> None:
    op.alter_column('users', 'phone',
                    existing_type=sa.String(20),
                    type_=sa.VARCHAR(),
                    existing_nullable=True)
``` 